{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

    @package   local_course_chatbot
    @copyright 2025, TomÃ¡s Pinto <morato.toms@gmail.com>
    @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
}}
{{!
    @template local_course_chatbot/chatbot_modal

}}

<!-- Chat Button positioned at bottom-left -->
<div class="position-fixed bottom-0 start-0 p-3" style="z-index: 1050;">
    <div class="course-chatbot-button" id="chatBtn" onclick="showChatModal()" style="cursor: pointer;">
        ðŸ¤– Chat with AI Course Assistant
    </div>
</div>

<!-- Chat Modal - positioned but not blocking -->
<div id="chatModal" class="position-fixed" style="display: none; bottom: 100px; left: 20px; width: 25%; min-width: 300px; max-width: 400px; z-index: 1051;">
    <div class="p-2 bg-white rounded shadow-sm border">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">âœ¨ AI Course Assistant</h6>
            <span class="close" onclick="showChatModal()" style="cursor: pointer; font-size: 1.2em;">&times;</span>
        </div>
        <div id="chat-container" class="pt-4 py-4 overflow-y-auto" style="max-height: 400px;">
            <!-- Chat history will be loaded here -->
        </div>
        <form class="message-form d-flex gap-2" id="messageForm">
            <input type="hidden" name="id" value="{{course_id}}" />
            <input type="hidden" name="chatbot_id" value="{{chatbot_id}}" />
            <input type="hidden" name="user_email" value="{{user_email}}" />
            <input type="hidden" name="user_name" value="{{user_name}}" />
            <input class="form-control border-secondary flex-grow-1" type="text" id="messageInput" placeholder="Type your message..." autocomplete="off" />
            <button class="btn btn-secondary" type="submit" id="sendBtn">Send <i class="fas fa-paper-plane"></i></button>
        </form>
        </div>
</div>